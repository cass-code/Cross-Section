---
# IMPORTANT: Change settings here, but DO NOT change the spacing.
# Remove comments and add values where applicable.
# The descriptions below should be self-explanatory

#title: "Helping You Write Academic Papers in R using Texevier"
#subtitle: "This will appear as Right Header"

documentclass: "elsarticle"

# --------- Thesis title (Optional - set to FALSE by default).
# You can move the details below around as you please.
Thesis_FP: TRUE
Entry1: "LATE to the Party: Investigating Instrument Variables for Education"
Entry2: "\\textbf{Cassandra Pengelly}" # textbf for bold
Entry3: "20346212"
Uni_Logo: Tex/logo.jpeg # Place a logo in the indicated location (from your root, e.g. defaults to ~/Tex/Logo.png) and uncomment this line. Leave uncommented for no image
Logo_width: 1 # If using a logo - use this to set width (size) of image
Entry4: "\\textbf{Econometrics 871: Cross Section Project}"
Entry5: "Stellenbosch University"
Entry6: July 2021
# Entry7:
# Entry8:

# --------- Front Page
# Comment: ----- Follow this pattern for up to 5 authors
# AddTitle: TRUE # Use FALSE when submitting to peer reviewed platform. This will remove author names.
# Author1: "Nico Katzke^[__Contributions:__  \\newline _The authors would like to thank no institution for money donated to this project. Thank you sincerely._]"  # First Author - note the thanks message displayed as an italic footnote of first page.
# Ref1: "Prescient Securities, Cape Town, South Africa" # First Author's Affiliation
# Email1: "nfkatzke\\@gmail.com" # First Author's Email address
# 
# Author2: "John Smith"
# Ref2: "Some other Institution, Cape Town, South Africa"
# Email2: "John\\@gmail.com"
# CommonAffiliation_12: TRUE # If Author 1 and 2 have a common affiliation. Works with _13, _23, etc.
# 
# Author3: "John Doe"
# Email3: "Joe\\@gmail.com"

# CorrespAuthor_1: TRUE  # If corresponding author is author 3, e.g., use CorrespAuthor_3: TRUE
# 
# # Comment out below to remove both. JEL Codes only given if keywords also given.
# keywords: "Multivariate GARCH \\sep Kalman Filter \\sep Copula" # Use \\sep to separate
# JELCodes: "L250 \\sep L100"

# ----- Manage headers and footers:
#BottomLFooter: $Title$
#BottomCFooter:
#TopLHeader: \leftmark # Adds section name at topleft. Remove comment to add it.
BottomRFooter: "\\footnotesize Page \\thepage" # Add a '#' before this line to remove footer.
addtoprule: TRUE
addfootrule: TRUE               # Use if footers added. Add '#' to remove line.

# --------- page margins:
margin: 2.3 # Sides
bottom: 2 # bottom
top: 2.5 # Top
HardSet_layout: TRUE # Hard-set the spacing of words in your document. This will stop LaTeX squashing text to fit on pages, e.g.
# This is done by hard-setting the spacing dimensions. Set to FALSE if you want LaTeX to optimize this for your paper.

# --------- Line numbers
linenumbers: FALSE # Used when submitting to journal

# ---------- References settings:
# You can download cls format here: https://www.zotero.org/ - simply search for your institution. You can also edit and save cls formats here: https://editor.citationstyles.org/about/
# Hit download, store it in Tex/ folder, and change reference below - easy.
bibliography: Tex/ref.bib       # Do not edit: Keep this naming convention and location.
csl: Tex/harvard-stellenbosch-university.csl # referencing format used.
# By default, the bibliography only displays the cited references. If you want to change this, you can comment out one of the following:
#nocite: '@*' # Add all items in bibliography, whether cited or not
# nocite: |  # add specific references that aren't cited
#  @grinold2000
#  @Someoneelse2010

# ---------- General:
RemovePreprintSubmittedTo: TRUE  # Removes the 'preprint submitted to...' at bottom of titlepage
Journal: "Journal of Finance"   # Journal that the paper will be submitting to, if RemovePreprintSubmittedTo is set to TRUE.
toc: TRUE                       # Add a table of contents
numbersections: TRUE             # Should sections (and thus figures and tables) be numbered?
fontsize: 11pt                  # Set fontsize
linestretch: 1.2                # Set distance between lines.
link-citations: TRUE            # This creates dynamic links to the papers in reference list.

### Adding additional latex packages:
# header-includes:
#    - \usepackage{colortbl} # Add additional packages here.

output:
  pdf_document:
    keep_tex: TRUE
    template: Tex/TexDefault.txt
    fig_width: 3.5 # Adjust default figure sizes. This can also be done in the chunks of the text.
    fig_height: 3.5
# abstract: |
#   This essay estimates the return to education using four different instrumental variable estimators: the first two exploit parents' education, and the other two use parents' occupation. These instruments estimate a ‘local average treatment effect’, which is more appropriate than OLS estimators for analysing the returns to education for South Africa. These instruments are implemented on the NIDS Wave 5 data set. Specification tests reveal that all four instruments are valid and strong. The results show that the OLS estimates are downwardly biased compared with the IV estimates.
---

<!-- First: Set your default preferences for chunk options: -->

<!-- If you want a chunk's code to be printed, set echo = TRUE. message = FALSE stops R printing ugly package loading details in your final paper too. I also suggest setting warning = FALSE and checking for warnings in R, else you might find ugly warnings in your paper. -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width = 6, fig.height = 5, fig.pos="H", fig.pos = 'H')
if(!require("tidyverse")) install.packages("tidyverse")
library(tidyverse)
library(haven)
library(ivreg)
library(ggplot2)
#read in nids
data <- read_dta("data/Adult_W5_Anon_V1.0.0.dta")


```

\newpage
<!-- ############################## -->
<!-- # Start Writing here: -->
<!-- ############################## -->

# Introduction \label{Introduction}

The return to education is a cornerstone topic in labour economics and is of particular interest to policymakers. This is no different in South Africa, especially given the significant income inequality, which is often claimed to be strongly linked to differences in education. However, wages cannot simply be regressed on education because there is likely endogeneity present. This arises from the problem of there being an omitted variable, where education and wages are both correlated with a variable in the error term. One variable of this nature that has been extensively studied is innate ability (@hertz). Returns to schooling could be biased upwards if ability is positively correlated with both income and education. However, as @disc assesses, the overall findings of research on the impact of ability bias are inconclusive. In fact, @disc [p.1] notes that several papers find that returns to education are _downwardly_ biased. 

This paper will investigate whether OLS estimates are biased in the South African case by estimating the return to education using four different instrumental variable estimators: the first two exploit parents' education, and the other two use parents' occupations. These instruments estimate a ‘local average treatment effect’, which - this paper will argue - is more appropriate than OLS estimators for analysing the returns to education for South Africa. These instruments are tested for strength and validity and then implemented on the NIDS Wave 5 data set. This essay^[This essay was written in R using the Texevier package by @Texevier] is structured as follows: section \ref{data} details the data set used and discusses the descriptive statistics. Section \ref{meth} outlines the methodology and argues that the LATE assumptions for the instrumental variables hold. Following this, section \ref{results} presents the regression results and evaluates the robustness of the estimators used to obtain a causal effect. The final section, \ref{conclusion}, concludes.

# Data \label{data}

mention survey design for NIDS @nids
@isco for occupation classification

\ref{Figure1} gives a quick snapshot of the relationship between income and education. We can see that income and education are positively correlated, which is what we expect. We can  

```{r lineargraph,  warning =  FALSE, fig.align = 'center', fig.cap = "Income and Education Relationship \\label{Figure1}", fig.ext = 'png', fig.height = 3, fig.width = 6}

library(haven)
data <- read_dta("data/Adult_W5_Anon_V1.0.0.dta")
list.files('code/', full.names = T, recursive = T) %>% as.list() %>% walk(~source(.))
dfplot <- plot_eduInc(data) 

library(ggplot2)
  g <-
  ggplot(data = dfplot,aes(x = education, y = income, color=race)) +
  geom_point() +
    stat_smooth(method = "lm",
        col = "#000000",
        se = FALSE,
        size = 1) +
  theme_minimal()+
  # theme(legend.position = "none") +
 xlab("Education") +
  ylab("Income") +
    ggtitle("Plot of Income and Education")

g

```

```{r racegraph,  warning =  FALSE, fig.align = 'center', fig.cap = "Income and Education Relationship \\label{Figure1}", fig.ext = 'png', fig.height = 3, fig.width = 6}

library(haven)
data <- read_dta("data/Adult_W5_Anon_V1.0.0.dta")
list.files('code/', full.names = T, recursive = T) %>% as.list() %>% walk(~source(.))
dfplot <- plot_race(data)  


library(ggplot2)
g <- ggplot(dfplot) +
    geom_bar(aes(x = race, stat="identity", width=0.7, fill = race)) +
  theme_minimal() +
    xlab("Race") +
  ylab("People") +
  ggtitle("Race Proportions")
g

```
  
# Methodology \label{meth}
This project makes use of 4 different instrument variables: fathers occupation, mothers occupation, mothers education and fathers education

# Results \label{results}

## Specification Tests


```{r regression1,  echo=FALSE, warning =  FALSE,message= FALSE, fig.align = 'center', fig.cap = "Regressions with log(income) as the dependent variable \\label{reg1}", fig.ext = 'png', fig.height = 3, fig.width = 6, results='asis'}
library(haven)
library(ivreg)

list.files('code/', full.names = T, recursive = T) %>% as.list() %>% walk(~source(.))
#w4 <- read_dta("data/Adult_W4_Anon_V2.0.0.dta")

d1 <- iv_father(data)
d2 <- iv_mother(data)
d3 <- f_occ(data)
d4 <- m_occ(data)

lm1 <-lm(income ~ age+ age2+ education + race + gender, d1)

iv1 <- ivreg(income ~ age + age2 + race + gender| education | father_ed, data = d1)
iv2 <- ivreg(income ~ age + age2 + race + gender| education | mother_ed, data = d2)
iv3 <- ivreg(income ~ age + age2 + race + gender| education | father_occ, data = d3)
iv4 <- ivreg(income ~ age + age2 + race + gender| education | mother_occ, data = d4)

library(huxtable)
Title <- "Regressions: Father's Education as Instrument"
Label <- "reg1"
htab <-
huxreg("OLS" = lm1, "2SLS FE" = iv1, "2SLS ME" = iv2, "2SLS FO" = iv3, "2SLS MO" = iv4,
                coefs = c("age" = "age", "age2" = "age2", "education" = "education", "Coloured" = "raceColoured", "Asian/Indian" = "raceAsian/Indian", "White" = "raceWhite", "Male" = "genderMale" ),
                statistics = c(N = "nobs", R2 = "r.squared"),
                note = "%stars%.") %>%
  set_caption(Title) %>%
  set_label(Label)
font_size(htab) <- 12
htab

```


```{r ShortTable, results = 'asis'}

# library(xtable)
# data <- mtcars[1:5,] %>% tibble::as_tibble()
# 
# table <- xtable(data, caption = "Short Table Example \\label{tab1}")
#   print.xtable(table,
#              # tabular.environment = "longtable",
#              floating = TRUE,
#              table.placement = 'H',
#              # scalebox = 0.3,
#              comment = FALSE,
#              caption.placement = 'bottom'
#              )

```

wn possibly long tables. Note that the following will fit on one page if it can, but cleanly spreads over multiple pages:

```{r LongTable, results = 'asis'}
# 
# library(xtable)
# 
# data = mtcars %>% tibble::as_tibble()
#   addtorow          <- list()
#   addtorow$pos      <- list()
#   addtorow$pos[[1]] <- c(0)
#   addtorow$command  <- c(paste("\\hline \n",
#                                "\\endhead \n",
#                                "\\hline \n",
#                                "{\\footnotesize Continued on next page} \n",
#                                "\\endfoot \n",
#                                "\\endlastfoot \n",sep=""))
# table <- xtable(data, caption = "Long Table Example")
#   print.xtable(table,
#              tabular.environment = "longtable",
#              floating = FALSE, # Leave this as is.
#              table.placement = 'H', # Leave this as is.
#              booktabs = T, # Aesthetics
#              include.rownames = FALSE,  # Typically you don't want this in a table.
#              add.to.row = addtorow, # For adding the Continued on next page part...
#              comment = FALSE,
#              caption.placement = 'top',  # Where do you want the caption?
#              size="\\fontsize{12pt}{13pt}\\selectfont"  # Size of text in table..
#              )
# See https://cran.r-project.org/web/packages/xtable/vignettes/xtableGallery.pdf for table inspiration
```

# Conclusion \label{conclusion}

 You should NOT write an extensive essay about the topic of interest, nor should you conduct
an extensive literature review behind it: you should only reference articles that support the
motivation for your econometric strategy (in the quest of finding a causal interpretation of a relationship that you are modeling).
Provide descriptive statistics and graphs to aid in your discussion.
The assignment should be between 3-6 pages, including your tables and figures.

You are required to go beyond simply estimating and presenting your results, but to convince the reader of their robustness by presenting alternative specifications. You should apply different estimators and specifications where possible. Discuss the shortcomings of the estimators in obtaining a causal effect and argue why your strategy is the best available to obtain a causal effect that satisfies relevant assumptions.

Determine an effect of interest and find instrumental variables to estimate it causally. If possible, use more than one instrument. Given the LATE assumptions, try and explain why your results differ and which is likely to represent the causal effect you are looking for. Conduct sufficient specification tests to establish whether you are overidentifying your instrument set or whether the IVs shift the estimates enough to indicate that OLS would be inconsistent.

\begin{figure}[htbp]
\centering
\includegraphics{Tex/conclusion.jpg}
\caption{\label{con}}
\end{figure}


\newpage

# References {-}

<div id="refs"></div>


# Appendix {-}

## Appendix A {-}

Some appendix information here

## Appendix B {-}

